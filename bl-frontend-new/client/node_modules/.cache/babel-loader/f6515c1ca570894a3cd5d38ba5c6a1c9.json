{"ast":null,"code":"var _jsxFileName = \"/app/src/pages/ReportDialog.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { useHistory } from \"react-router-dom\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport { CircularProgress } from '@material-ui/core';\nimport axios from 'axios';\nimport { connect } from 'react-redux';\nimport { isEmpty, onToast } from '../utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst ReportDialog = props => {\n  _s();\n\n  const history = useHistory();\n  const [nid, setNid] = useState(0);\n  const [showModal, setShowModal] = useState(false);\n  const [category, setCategory] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [reportLoading, setReportLoading] = useState(false);\n  const [itemCategory, setItemCategory] = React.useState([{\n    \"id\": 0,\n    \"label\": \"--เลือก--\"\n  }, {\n    \"id\": 1,\n    \"label\": \"แจ้งลบ\"\n  }, {\n    \"id\": 2,\n    \"label\": \"ข้อมูลไม่ครบถ้วน\"\n  }, {\n    \"id\": 3,\n    \"label\": \"อื่นๆ\"\n  }]); // Attach file\n\n  const [attachFiles, setAttachFiles] = useState([]);\n  useEffect(() => {\n    console.log('ReportDialog >> ', props);\n    setShowModal(props.showModal);\n    setNid(props.item.id);\n  });\n\n  const handleReport = e => {\n    if (isEmpty(category) && isEmpty(message)) {\n      onToast('error', \"Category, message is empty\");\n    } else if (isEmpty(category)) {\n      onToast('error', \"Category is empty\");\n    } else if (isEmpty(message)) {\n      onToast('error', \"Message is empty\");\n    } else {\n      const data = new FormData();\n      data.append('nid', nid);\n      data.append('category', category);\n      data.append('message', message);\n      attachFiles.map(file => {\n        data.append('files[]', file);\n      });\n      setReportLoading(true);\n      axios.post(`/api/report?_format=json`, data, {\n        headers: {\n          'Authorization': `Basic ${props.user.basic_auth}`,\n          'content-type': 'multipart/form-data'\n        }\n      }).then(response => {\n        let results = response.data;\n        console.log(\"/api/report response :\", results);\n\n        if (results.result) {\n          handleClose();\n          onToast('info', \"Report success\");\n        } else {\n          onToast('error', results.message);\n        }\n\n        setReportLoading(false);\n      }).catch(error => {\n        console.log(\"/api/report error :\", error);\n        onToast('error', error);\n        setReportLoading(false);\n      });\n    }\n  };\n\n  const handleClose = () => {\n    props.onClose();\n  };\n\n  const changeFiles = e => {\n    var filesArr = Array.prototype.slice.call(e.target.files);\n    setAttachFiles([...attachFiles, ...filesArr]);\n  };\n\n  const removeFile = f => {\n    setAttachFiles(attachFiles.filter(x => x !== f));\n  };\n\n  const bodyContent = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Select category\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"select\", {\n            value: category,\n            name: `bank_wallet`,\n            id: `bank-wallet`,\n            onChange: e => {\n              setCategory(e.target.value);\n            },\n            children: itemCategory.map(item => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: item.id,\n              children: item.label\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 101,\n              columnNumber: 33\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Messasge\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          id: \"message\",\n          name: \"message\",\n          placeholder: \"enter message\",\n          style: {\n            width: '100%'\n          },\n          rows: \"4\",\n          cols: \"50\",\n          onChange: e => {\n            setMessage(e.target.value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Attach file\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"custom-file-upload\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            multiple: true,\n            onChange: changeFiles\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fa fa-cloud-upload\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 29\n          }, this), \" Attach\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"file-preview\",\n          children: attachFiles.map(file => {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"inline-block\",\n                padding: \"5px\"\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  width: \"50\",\n                  height: \"60\",\n                  src: URL.createObjectURL(file)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 131,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    cursor: \"pointer\"\n                  },\n                  onClick: () => removeFile(file),\n                  children: \"X\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 132,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 130,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 41\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 17\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Modal, {\n      show: showModal,\n      onHide: props.onClose // onSubmit={handleSubmit}\n      ,\n      bsSize: \"large\",\n      backdrop: \"static\",\n      children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n        closeButton: true,\n        children: /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Report\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n        children: bodyContent()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          variant: \"secondary\",\n          onClick: handleClose,\n          children: \"Close \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          onClick: handleReport,\n          children: [\"Report \", reportLoading && /*#__PURE__*/_jsxDEV(CircularProgress, {\n            size: 15\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 91\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ReportDialog, \"DD76+7FegJ9O653ZkI7hOZ0rGp4=\", false, function () {\n  return [useHistory];\n});\n\n_c = ReportDialog;\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    user: state.user.data\n  };\n};\n\nconst mapDispatchToProps = {};\nexport default connect(mapStateToProps, mapDispatchToProps)(ReportDialog);\n\nvar _c;\n\n$RefreshReg$(_c, \"ReportDialog\");","map":{"version":3,"sources":["/app/src/pages/ReportDialog.js"],"names":["React","useState","useEffect","useHistory","Modal","Button","CircularProgress","axios","connect","isEmpty","onToast","ReportDialog","props","history","nid","setNid","showModal","setShowModal","category","setCategory","message","setMessage","reportLoading","setReportLoading","itemCategory","setItemCategory","attachFiles","setAttachFiles","console","log","item","id","handleReport","e","data","FormData","append","map","file","post","headers","user","basic_auth","then","response","results","result","handleClose","catch","error","onClose","changeFiles","filesArr","Array","prototype","slice","call","target","files","removeFile","f","filter","x","bodyContent","value","label","width","display","padding","URL","createObjectURL","cursor","mapStateToProps","state","ownProps","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useHistory } from \"react-router-dom\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport { CircularProgress } from '@material-ui/core';\nimport axios from 'axios';\nimport { connect } from 'react-redux'\n\nimport {isEmpty, onToast} from '../utils'\n\nconst ReportDialog = (props) => {\n    const history = useHistory();\n\n    const [nid, setNid] = useState(0);\n    const [showModal, setShowModal] = useState(false);\n    const [category, setCategory]   = useState(\"\");\n    const [message, setMessage]     = useState(\"\");\n    const [reportLoading, setReportLoading] = useState(false);\n    \n    const [itemCategory, setItemCategory]   = React.useState([{\"id\":0, \"label\": \"--เลือก--\"}, {\"id\":1, \"label\": \"แจ้งลบ\"}, {\"id\":2, \"label\": \"ข้อมูลไม่ครบถ้วน\"}, {\"id\":3, \"label\": \"อื่นๆ\"}])\n\n    // Attach file\n    const [attachFiles, setAttachFiles] = useState([]);\n\n    useEffect(() => {\n        console.log('ReportDialog >> ', props)\n\n        setShowModal(props.showModal)\n        setNid(props.item.id)\n    });\n\n    const handleReport = (e) => {\n        if( isEmpty(category) && isEmpty(message) ){\n            onToast('error', \"Category, message is empty\")\n        }else if(isEmpty(category)){\n            onToast('error', \"Category is empty\")\n        }else if(isEmpty(message)){\n            onToast('error', \"Message is empty\")\n        }else{\n            const data = new FormData();\n\n            data.append('nid', nid);\n            data.append('category', category );\n            data.append('message', message);\n            attachFiles.map((file) => { data.append('files[]', file) })\n\n            setReportLoading(true)\n            axios.post(`/api/report?_format=json`, data, {\n                headers: { \n                    'Authorization': `Basic ${props.user.basic_auth}`,\n                    'content-type': 'multipart/form-data'\n                }\n            })\n            .then((response) => {\n                let results = response.data\n                console.log(\"/api/report response :\", results)\n                \n                if(results.result){\n                    handleClose()\n                    onToast('info', \"Report success\")\n                }else{\n                    onToast('error', results.message)\n                }\n                setReportLoading(false)\n            })\n            .catch((error) => {\n                console.log(\"/api/report error :\", error)\n\n                onToast('error', error)\n                setReportLoading(false)\n            });\n        }        \n    }\n\n    const handleClose = () => {\n        props.onClose()\n    }\n\n    const changeFiles = (e) => {\n        var filesArr = Array.prototype.slice.call(e.target.files);\n        setAttachFiles([...attachFiles, ...filesArr])\n    }\n\n    const removeFile = (f) => {\n        setAttachFiles(attachFiles.filter((x) => x !== f))\n    }\n\n    const bodyContent =()=>{\n        return( <div>\n                    <div>\n                        <div>\n                            Select category\n                        </div>\n                        <div>\n                        <select \n                            value={category}\n                            name={`bank_wallet`}\n                            id={`bank-wallet`}\n                            onChange={(e)=>{ setCategory(e.target.value) }} >\n                            {\n                            itemCategory.map((item)=>\n                                <option value={item.id}>{item.label}</option>\n                            )\n                            }\n                        </select>\n                        </div>\n                    </div>\n                    <div>\n                        <div>Messasge</div>\n                        <textarea \n                            id=\"message\" \n                            name=\"message\" \n                            placeholder=\"enter message\"\n                            style={{width: '100%'}} \n                            rows=\"4\" cols=\"50\" \n                            onChange={((e)=>{\n                                setMessage(e.target.value)\n                            })}/>\n                    </div>\n                    <div>\n                        <div>Attach file</div>\n                        <label className=\"custom-file-upload\">\n                            <input type=\"file\" multiple onChange={changeFiles} />\n                            <i className=\"fa fa-cloud-upload\" /> Attach\n                        </label>\n                        <div className=\"file-preview\">\n                            {\n                                attachFiles.map((file) => {\n                                    return (\n                                        <div style={{ display: \"inline-block\", padding: \"5px\" }}>\n                                        <div>\n                                            <img width=\"50\" height=\"60\" src={URL.createObjectURL(file)} />\n                                            <div style={{cursor: \"pointer\"}} onClick={()=>removeFile(file)}>X</div>\n                                        </div>\n                                        </div>\n                                    );\n                                })\n                            }\n                        </div>\n                    </div>\n                </div>)\n    }\n\n    return (\n        <div>\n        <Modal\n            show={showModal}\n            onHide={props.onClose}\n            // onSubmit={handleSubmit}\n            bsSize=\"large\"\n            backdrop=\"static\">\n            <Modal.Header closeButton={true}>\n                <h2>Report</h2>\n            </Modal.Header>\n            <Modal.Body>\n                {bodyContent()}\n            </Modal.Body>\n            <Modal.Footer>\n                <Button variant=\"secondary\" onClick={handleClose}>Close </Button>\n                <Button variant=\"primary\" onClick={handleReport}>Report {reportLoading && <CircularProgress size={15}/>}</Button>\n            </Modal.Footer>\n        </Modal>\n        </div>\n    );\n}\n\nconst mapStateToProps = (state, ownProps) => {\n\treturn { user: state.user.data }\n}\n\nconst mapDispatchToProps = {}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ReportDialog)"]},"metadata":{},"sourceType":"module"}