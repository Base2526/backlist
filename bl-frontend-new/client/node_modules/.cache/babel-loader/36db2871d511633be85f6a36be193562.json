{"ast":null,"code":"var _jsxFileName = \"/app/src/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { BrowserRouter, Router, Route, Switch } from 'react-router-dom';\nimport Container from 'react-bootstrap/Container';\nimport { ToastContainer, toast } from 'react-toastify';\nimport LoadingOverlay from 'react-loading-overlay';\nimport io from 'socket.io-client';\nimport { CacheSwitch, CacheRoute } from \"react-router-cache-route\";\nimport axios from 'axios';\nimport { Base64 } from 'js-base64';\nimport ls from 'local-storage';\nimport { deviceDetect } from \"react-device-detect\";\nimport HeaderBar from \"./components/HeaderBar\";\nimport Breadcrumb from \"./components/Breadcrumb\";\nimport Footer from './components/Footer';\nimport routes from \"./routes\";\nimport ScrollToTopBtn from \"./components/ScrollToTopBtn\";\nimport { userLogin, userLogout } from './actions/user';\nimport { addMyApp, updateMyApp, deleteMyApp } from './actions/my_apps';\nimport { onMyFollowALL, onMyFollowUpdateStatus } from './actions/my_follows';\nimport { onConnect, onDisconnect } from './actions/socket';\nimport { addContentsData, addFollowsData } from './actions/app';\nimport { setMaintenance } from './actions/setting';\nimport history from './history';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _ = require('lodash');\n\nlet socket = undefined;\nlet interval = undefined;\n\nconst App = props => {\n  _s();\n\n  const [maintenance, setMaintenance] = useState();\n  const [isLoadingOverlay, setIsLoadingOverlay] = useState();\n  useEffect(() => {\n    checkLocalStorage();\n    setMaintenance(false);\n    return () => {\n      setMaintenance();\n      socket = undefined;\n      interval = undefined;\n    };\n  }, []);\n  useEffect(() => {\n    setMaintenance(props.maintenance);\n  }, [props.maintenance]);\n  useEffect(() => {\n    setIsLoadingOverlay(props.is_loading_overlay);\n  }, [props.is_loading_overlay]);\n  useEffect(() => {\n    // console.log('socketid() > [props.user] #0 > ', props.user , socket )  \n    if (!_.isEmpty(socket)) {\n      socket.disconnect();\n      socket = null;\n    }\n\n    socketid();\n  }, [props.user]);\n  useEffect(async () => {\n    if (_.isEmpty(interval)) {\n      clearInterval(interval);\n      interval = undefined;\n    } // console.log('useEffect [props.follows] #1: ')\n\n\n    let {\n      user,\n      follows\n    } = props; // console.log(\"useEffect [props.follows] #2:\", user, _.isEmpty(user), props)\n\n    if (!_.isEmpty(user)) {\n      if (_.isEmpty(follows)) {\n        return;\n      }\n\n      let filter_follow_ups = follows.filter(im => im.local); // console.log(\"useEffect [props.follows] #3:\", filter_follow_ups)\n\n      if (!_.isEmpty(filter_follow_ups)) {\n        interval = setInterval(async props => {\n          let {\n            user,\n            follows\n          } = props;\n          let response = await axios.post(`/api/v1/syc_local`, {\n            uid: user.uid,\n            follows: JSON.stringify(follows)\n          }, {\n            headers: {\n              'Authorization': `Basic ${ls.get('basic_auth')}`\n            }\n          });\n          response = response.data;\n          console.log(\"/api/v1/syc_local : \", response);\n\n          if (response.result) {// props.onMyFollowUpdateStatus({})\n          }\n\n          clearInterval(interval);\n        }, 2000, props);\n      } else {// console.log(\"useEffect [props.follows] #5:\")\n      }\n    } else {// console.log(\"useEffect [props.follows] #6:\")\n    }\n  }, [props.follows]);\n\n  const checkLocalStorage = () => {\n    // http://apassant.net/2012/01/16/timeout-for-html5-localstorage/\n    var hours = 4; // Reset when storage is more than 24hours\n\n    var now = new Date().getTime();\n    var setupTime = localStorage.getItem('setupTime');\n\n    if (setupTime == null) {\n      localStorage.setItem('setupTime', now);\n    } else {\n      if (now - setupTime > hours * 60 * 60 * 1000) {\n        // localStorage.clear()\n        localStorage.removeItem('geolocation');\n        localStorage.setItem('setupTime', now);\n      }\n    }\n  };\n\n  const geolocation = async () => {\n    let data = JSON.parse(localStorage.getItem(\"geolocation\"));\n\n    if (_.isEmpty(data)) {\n      const res = await axios.get(process.env.REACT_APP_GEOLOCATION);\n\n      if (res.status === 200) {\n        data = res.data;\n      }\n\n      localStorage.setItem('geolocation', JSON.stringify(data));\n    }\n\n    return data;\n  };\n\n  const socketid = async () => {\n    // console.log('process.env :', process.env, ', props : ', props, ', geolocation : ', await geolocation())\n    if (_.isEmpty(socket)) {\n      socket = io(\"/\", // { headers:  {'Authorization': `Basic ${process.env.REACT_APP_AUTHORIZATION}`} },\n      // {\n      //   auth: {\n      //     token: \"abcd\"\n      //   }\n      // },\n      {\n        // path: '/mysocket',\n        // 'sync disconnect on unload': false,\n        'sync disconnect on unload': true,\n        query: {\n          // \"platform\" : process.env.REACT_APP_PLATFORM, \n          // \"unique_id\": _uniqueId(props),\n          \"version\": process.env.REACT_APP_VERSIONS,\n          \"device_detect\": JSON.stringify(deviceDetect()),\n          \"geolocation\": JSON.stringify(await geolocation()),\n          auth_token: _.isEmpty(props.user) ? 0 : props.user.uid\n        } // transports: [\"websocket\"]\n\n      } // { transports: [\"websocket\"] }\n      );\n    } else {\n      socket.auth.token = _.isEmpty(props.user) ? 0 : props.user.uid;\n      socket.disconnect().connect();\n      console.log('------------- disconnect ------------- #3');\n    }\n\n    if (socket.connected === false && socket.connecting === false) {\n      // use a connect() or reconnect() here if you want\n      socket.connect();\n      console.log('reconnected!');\n      socket.off('connect', onConnect);\n      socket.off(\"uniqueID\", onUniqueID);\n      socket.off('disconnect', onDisconnect);\n      socket.off('connect_error', handleErrors);\n      socket.off('connect_failed', handleErrors);\n      socket.off('onSyc', handleSyc);\n      socket.off('onUser', onUser);\n      socket.off('onProfile', onProfile);\n      socket.off('onContent', onContent);\n      socket.off('onMyFollows', onMyFollows);\n      socket.off('test', test);\n      socket.off('onAppFollowers', onAppFollowers);\n    } else {// console.log('socket :', socket)\n    }\n\n    socket.on('connect', onConnect);\n    socket.on(\"uniqueID\", onUniqueID);\n    socket.on('disconnect', onDisconnect);\n    socket.on('connect_error', handleErrors);\n    socket.on('connect_failed', handleErrors);\n    socket.on('onSyc', handleSyc);\n    socket.on('onUser', onUser);\n    socket.on('onProfile', onProfile);\n    socket.on('onContent', onContent);\n    socket.on('onMyFollows', onMyFollows);\n    socket.on('test', test);\n    socket.off('onAppFollowers', onAppFollowers);\n  };\n\n  const handleSyc = i => {\n    console.log(\"handleSyc :\", i);\n\n    switch (i.type) {\n      case 'user':\n        {\n          let {\n            operation_type\n          } = i;\n\n          switch (operation_type) {\n            case 'delete':\n              {\n                ls.remove('basic_auth');\n                ls.remove('session');\n                socket.disconnect();\n                props.userLogout();\n                history.push(\"/\");\n                break;\n              }\n          }\n\n          break;\n        }\n\n      case 'follows':\n        {\n          let {\n            operation_type,\n            datas\n          } = i;\n\n          switch (operation_type) {\n            case 'insert':\n              {\n                break;\n              }\n\n            case 'replace':\n            case 'update':\n              {\n                props.addFollowsData(datas);\n                break;\n              }\n          }\n\n          break;\n        }\n\n      case 'setting':\n        {\n          let {\n            operation_type,\n            datas\n          } = i;\n\n          switch (operation_type) {\n            case 'maintenance':\n              {\n                props.setMaintenance(false);\n                break;\n              }\n          }\n\n          break;\n        }\n    }\n  };\n\n  const test = data => {\n    console.log(\"test :\", data);\n  };\n\n  const handleErrors = err => {\n    console.log('connect_error + connect_failed', err);\n  };\n\n  const onConnect = () => {\n    console.log('Socket io, connent!');\n    props.onConnect({\n      connected: socket.connected\n    }); // props.setMaintenance(false)\n  };\n\n  const onDisconnect = () => {\n    console.log('Socket io, disconnect!');\n    props.onDisconnect(); // props.setMaintenance(true)\n  };\n\n  const onUniqueID = data => {// console.log(\"unique_id :\", data)\n    // ls.set('socketIO', JSON.stringify(data))\n    // var socketIO = ls.get('socketIO')\n    // console.log(\"socketIO :\", socketIO)\n  };\n\n  const onUser = data => {\n    console.log(\"onUser :\", data);\n    /*\n    try {\n      let mode = data.mode\n      console.log(\"onUser mode\", mode)\n      switch(mode){\n        case 'delete':{\n          socket.disconnect();\n           console.log('------------- disconnect ------------- #4')\n           ls.remove('basic_auth')\n          ls.remove('session')\n          props.userLogout()\n           console.log(\"onUser ok\",)\n          break;\n        }\n      }\n    } catch (error) {\n      // Catch internal functions, variables and return (jsx) errors.\n      // You can also create a lib to log the error to an error reporting service\n      // and use it here.\n      console.log(\"onUser error :\", error)\n    }\n     */\n    // mode: \"delete\"\n  };\n\n  const onProfile = data => {\n    props.userLogin(data);\n  };\n\n  const onContent = data => {\n    console.log(\"onContent :\", data); // mode: \"edit\", nid: \"104\"}\n\n    try {\n      let mode = data.mode;\n      console.log(\"onContent mode\", mode);\n\n      switch (mode) {\n        case 'add':\n          {\n            console.log(\"onContent add\");\n            props.addMyApp(data);\n            break;\n          }\n\n        case 'edit':\n          {\n            console.log(\"onContent edit\");\n            props.updateMyApp(data);\n            break;\n          }\n\n        case 'delete':\n          {\n            console.log(\"onContent delete\");\n            props.deleteMyApp(data);\n            break;\n          }\n      }\n    } catch (error) {\n      // Catch internal functions, variables and return (jsx) errors.\n      // You can also create a lib to log the error to an error reporting service\n      // and use it here.\n      console.log(\"onContent error :\", error);\n    }\n  };\n\n  const onMyFollows = data => {\n    try {\n      console.log(\"MY_FOLLOW_ALL : \", data);\n      props.onMyFollowALL(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const onAppFollowers = data => {\n    console.log(\"onAppFollowers : \", data); // props.onMyFollowALL(data)\n  };\n\n  const onMaintenance = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"We\\u2019ll be back soon! Sorry for the inconvenience but we\\u2019re performing some maintenance at the moment. We\\u2019ll be back online shortly!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 13\n    }, this);\n  };\n\n  const onMainView = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Container, {\n        children: [/*#__PURE__*/_jsxDEV(ToastContainer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(CacheSwitch, {\n          children: routes.map(({\n            path,\n            name,\n            Component\n          }, key) => /*#__PURE__*/_jsxDEV(CacheRoute, {\n            exact: true,\n            path: path,\n            render: props => {\n              const crumbs = routes // Get all routes that contain the current one.\n              .filter(({\n                path\n              }) => props.match.path.includes(path)) // Swap out any dynamic routes with their param values.\n              // E.g. \"/pizza/:pizzaId\" will become \"/pizza/1\"\n              .map(({\n                path,\n                ...rest\n              }) => ({\n                path: Object.keys(props.match.params).length ? Object.keys(props.match.params).reduce((path, param) => path.replace(`:${param}`, props.match.params[param]), path) : path,\n                ...rest\n              })); // if(this.props.logged_in){\n              //   connect_socketIO(this.props)\n              // }\n              // console.log();\n              // console.log(`Generated crumbs for ${props.match.path}`);\n\n              crumbs.map(({\n                name,\n                path\n              }) => {} //  console.log({ name, path })\n              );\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-gray25\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"container\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"row\",\n                    children: /*#__PURE__*/_jsxDEV(Breadcrumb, {\n                      crumbs: crumbs\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 441,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 440,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Component, { ...props\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 444,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(ScrollToTopBtn, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 446,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 439,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 438,\n                columnNumber: 25\n              }, this);\n            }\n          }, key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 407,\n            columnNumber: 19\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 13\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Router, {\n    history: history,\n    children: /*#__PURE__*/_jsxDEV(LoadingOverlay, {\n      active: isLoadingOverlay,\n      spinner: true,\n      text: \"Wait...\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App\",\n        children: [/*#__PURE__*/_jsxDEV(HeaderBar, { ...props\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 465,\n          columnNumber: 19\n        }, this), maintenance ? onMaintenance : onMainView]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 460,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 459,\n    columnNumber: 11\n  }, this);\n};\n\n_s(App, \"HlxnDSlg/cp7qCqkKu2oj53r2dA=\");\n\n_c = App;\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    user: state.user.data,\n    my_apps: state.my_apps.data,\n    follow_ups: state.user.follow_ups,\n    my_follows: state.my_follows.data,\n    follows: state.app.follows,\n    is_loading_overlay: state.user.is_loading_overlay,\n    maintenance: state.setting.maintenance\n  };\n};\n\nconst mapDispatchToProps = {\n  userLogin,\n  userLogout,\n  addMyApp,\n  updateMyApp,\n  deleteMyApp,\n  onMyFollowALL,\n  onMyFollowUpdateStatus,\n  onConnect,\n  onDisconnect,\n  addFollowsData,\n  setMaintenance\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/app/src/App.js"],"names":["React","useEffect","useState","connect","BrowserRouter","Router","Route","Switch","Container","ToastContainer","toast","LoadingOverlay","io","CacheSwitch","CacheRoute","axios","Base64","ls","deviceDetect","HeaderBar","Breadcrumb","Footer","routes","ScrollToTopBtn","userLogin","userLogout","addMyApp","updateMyApp","deleteMyApp","onMyFollowALL","onMyFollowUpdateStatus","onConnect","onDisconnect","addContentsData","addFollowsData","setMaintenance","history","_","require","socket","undefined","interval","App","props","maintenance","isLoadingOverlay","setIsLoadingOverlay","checkLocalStorage","is_loading_overlay","isEmpty","disconnect","socketid","user","clearInterval","follows","filter_follow_ups","filter","im","local","setInterval","response","post","uid","JSON","stringify","headers","get","data","console","log","result","hours","now","Date","getTime","setupTime","localStorage","getItem","setItem","removeItem","geolocation","parse","res","process","env","REACT_APP_GEOLOCATION","status","query","REACT_APP_VERSIONS","auth_token","auth","token","connected","connecting","off","onUniqueID","handleErrors","handleSyc","onUser","onProfile","onContent","onMyFollows","test","onAppFollowers","on","i","type","operation_type","remove","push","datas","err","mode","error","onMaintenance","onMainView","map","path","name","Component","key","crumbs","match","includes","rest","Object","keys","params","length","reduce","param","replace","mapStateToProps","state","ownProps","my_apps","follow_ups","my_follows","app","setting","mapDispatchToProps"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,aAAT,EAAwBC,MAAxB,EAAgCC,KAAhC,EAAuCC,MAAvC,QAAqD,kBAArD;AACA,OAAOC,SAAP,MAAsB,2BAAtB;AACA,SAASC,cAAT,EAAyBC,KAAzB,QAAsC,gBAAtC;AACA,OAAOC,cAAP,MAA2B,uBAA3B;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,SAASC,WAAT,EAAsBC,UAAtB,QAAyC,0BAAzC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,MAAT,QAAuB,WAAvB;AACA,OAAOC,EAAP,MAAe,eAAf;AACA,SAASC,YAAT,QAA6B,qBAA7B;AACA,OAAOC,SAAP,MAAsB,wBAAtB;AACA,OAAOC,UAAP,MAAuB,yBAAvB;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AAEA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,cAAP,MAA2B,6BAA3B;AACA,SAASC,SAAT,EAAoBC,UAApB,QAAsC,gBAAtC;AACA,SAASC,QAAT,EAAmBC,WAAnB,EAAgCC,WAAhC,QAAmD,mBAAnD;AAEA,SAASC,aAAT,EAAwBC,sBAAxB,QAAsD,sBAAtD;AAEA,SAASC,SAAT,EAAoBC,YAApB,QAAwC,kBAAxC;AAEA,SAASC,eAAT,EAA0BC,cAA1B,QAAgD,eAAhD;AAEA,SAASC,cAAT,QAA+B,mBAA/B;AAEA,OAAOC,OAAP,MAAoB,WAApB;;;AAEA,IAAIC,CAAC,GAAGC,OAAO,CAAC,QAAD,CAAf;;AAEA,IAAIC,MAAM,GAAGC,SAAb;AACA,IAAIC,QAAQ,GAAGD,SAAf;;AAEA,MAAME,GAAG,GAAIC,KAAD,IAAW;AAAA;;AACrB,QAAM,CAACC,WAAD,EAAcT,cAAd,IAAkCjC,QAAQ,EAAhD;AACA,QAAM,CAAC2C,gBAAD,EAAmBC,mBAAnB,IAA4C5C,QAAQ,EAA1D;AAEAD,EAAAA,SAAS,CAAC,MAAM;AACd8C,IAAAA,iBAAiB;AAEjBZ,IAAAA,cAAc,CAAC,KAAD,CAAd;AACA,WAAO,MAAM;AACXA,MAAAA,cAAc;AAEdI,MAAAA,MAAM,GAAGC,SAAT;AACAC,MAAAA,QAAQ,GAAGD,SAAX;AACD,KALD;AAMD,GAVQ,EAUN,EAVM,CAAT;AAYAvC,EAAAA,SAAS,CAAC,MAAM;AACdkC,IAAAA,cAAc,CAACQ,KAAK,CAACC,WAAP,CAAd;AACD,GAFQ,EAEN,CAACD,KAAK,CAACC,WAAP,CAFM,CAAT;AAIA3C,EAAAA,SAAS,CAAC,MAAM;AACd6C,IAAAA,mBAAmB,CAACH,KAAK,CAACK,kBAAP,CAAnB;AACD,GAFQ,EAEN,CAACL,KAAK,CAACK,kBAAP,CAFM,CAAT;AAIA/C,EAAAA,SAAS,CAAC,MAAM;AAEd;AAEA,QAAI,CAACoC,CAAC,CAACY,OAAF,CAAUV,MAAV,CAAL,EAAwB;AACtBA,MAAAA,MAAM,CAACW,UAAP;AACAX,MAAAA,MAAM,GAAG,IAAT;AACD;;AACDY,IAAAA,QAAQ;AACT,GATQ,EASN,CAACR,KAAK,CAACS,IAAP,CATM,CAAT;AAWAnD,EAAAA,SAAS,CAAC,YAAW;AACnB,QAAIoC,CAAC,CAACY,OAAF,CAAUR,QAAV,CAAJ,EAAyB;AACvBY,MAAAA,aAAa,CAACZ,QAAD,CAAb;AAEAA,MAAAA,QAAQ,GAAGD,SAAX;AACD,KALkB,CAOnB;;;AAEA,QAAI;AAACY,MAAAA,IAAD;AAAOE,MAAAA;AAAP,QAAkBX,KAAtB,CATmB,CAUnB;;AACA,QAAG,CAACN,CAAC,CAACY,OAAF,CAAUG,IAAV,CAAJ,EAAoB;AAElB,UAAGf,CAAC,CAACY,OAAF,CAAUK,OAAV,CAAH,EAAsB;AACpB;AACD;;AAED,UAAIC,iBAAiB,GAAGD,OAAO,CAACE,MAAR,CAAgBC,EAAD,IAAMA,EAAE,CAACC,KAAxB,CAAxB,CANkB,CAQlB;;AACA,UAAG,CAACrB,CAAC,CAACY,OAAF,CAAUM,iBAAV,CAAJ,EAAiC;AAC/Bd,QAAAA,QAAQ,GAAGkB,WAAW,CAAC,MAAMhB,KAAN,IAAc;AACnC,cAAI;AAACS,YAAAA,IAAD;AAAOE,YAAAA;AAAP,cAAkBX,KAAtB;AACA,cAAIiB,QAAQ,GAAI,MAAM7C,KAAK,CAAC8C,IAAN,CAAY,mBAAZ,EACU;AACEC,YAAAA,GAAG,EAAEV,IAAI,CAACU,GADZ;AACiBR,YAAAA,OAAO,EAAES,IAAI,CAACC,SAAL,CAAeV,OAAf;AAD1B,WADV,EAIU;AAAEW,YAAAA,OAAO,EAAE;AAAC,+BAAkB,SAAQhD,EAAE,CAACiD,GAAH,CAAO,YAAP,CAAqB;AAAhD;AAAX,WAJV,CAAtB;AAMAN,UAAAA,QAAQ,GAAGA,QAAQ,CAACO,IAApB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoCT,QAApC;;AAEA,cAAGA,QAAQ,CAACU,MAAZ,EAAmB,CACjB;AACD;;AAEDjB,UAAAA,aAAa,CAACZ,QAAD,CAAb;AACD,SAhBqB,EAgBnB,IAhBmB,EAgBbE,KAhBa,CAAtB;AAiBD,OAlBD,MAkBM,CACJ;AACD;AACF,KA9BD,MA8BK,CACH;AACD;AACF,GA5CQ,EA4CN,CAACA,KAAK,CAACW,OAAP,CA5CM,CAAT;;AA8CA,QAAMP,iBAAiB,GAAG,MAAI;AAC5B;AAEA,QAAIwB,KAAK,GAAG,CAAZ,CAH4B,CAGb;;AACf,QAAIC,GAAG,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAV;AACA,QAAIC,SAAS,GAAGC,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAhB;;AACA,QAAIF,SAAS,IAAI,IAAjB,EAAuB;AACrBC,MAAAA,YAAY,CAACE,OAAb,CAAqB,WAArB,EAAkCN,GAAlC;AACD,KAFD,MAEO;AACL,UAAGA,GAAG,GAACG,SAAJ,GAAgBJ,KAAK,GAAC,EAAN,GAAS,EAAT,GAAY,IAA/B,EAAqC;AACnC;AAEAK,QAAAA,YAAY,CAACG,UAAb,CAAwB,aAAxB;AAEAH,QAAAA,YAAY,CAACE,OAAb,CAAqB,WAArB,EAAkCN,GAAlC;AACD;AACF;AAEF,GAlBD;;AAoBA,QAAMQ,WAAW,GAAG,YAAY;AAC9B,QAAIb,IAAI,GAAGJ,IAAI,CAACkB,KAAL,CAAWL,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAAX;;AACA,QAAGxC,CAAC,CAACY,OAAF,CAAUkB,IAAV,CAAH,EAAmB;AACjB,YAAMe,GAAG,GAAG,MAAMnE,KAAK,CAACmD,GAAN,CAAWiB,OAAO,CAACC,GAAR,CAAYC,qBAAvB,CAAlB;;AACA,UAAGH,GAAG,CAACI,MAAJ,KAAe,GAAlB,EAAsB;AACpBnB,QAAAA,IAAI,GAAGe,GAAG,CAACf,IAAX;AACD;;AAEDS,MAAAA,YAAY,CAACE,OAAb,CAAqB,aAArB,EAAoCf,IAAI,CAACC,SAAL,CAAeG,IAAf,CAApC;AACD;;AACD,WAAOA,IAAP;AACD,GAXD;;AAaA,QAAMhB,QAAQ,GAAG,YAAU;AACzB;AAEA,QAAGd,CAAC,CAACY,OAAF,CAAUV,MAAV,CAAH,EAAqB;AACnBA,MAAAA,MAAM,GAAG3B,EAAE,CAAE,GAAF,EACT;AAEA;AACA;AACA;AACA;AACA;AACA;AACE;AACA;AACA,qCAA6B,IAH/B;AAIE2E,QAAAA,KAAK,EAAE;AACL;AACA;AACA,qBAAaJ,OAAO,CAACC,GAAR,CAAYI,kBAHpB;AAIL,2BAAkBzB,IAAI,CAACC,SAAL,CAAgB9C,YAAY,EAA5B,CAJb;AAKL,yBAAgB6C,IAAI,CAACC,SAAL,CAAgB,MAAMgB,WAAW,EAAjC,CALX;AAMLS,UAAAA,UAAU,EAAEpD,CAAC,CAACY,OAAF,CAAUN,KAAK,CAACS,IAAhB,IAAwB,CAAxB,GAA4BT,KAAK,CAACS,IAAN,CAAWU;AAN9C,SAJT,CAYE;;AAZF,OARS,CAsBT;AAtBS,OAAX;AAwBD,KAzBD,MAyBK;AACHvB,MAAAA,MAAM,CAACmD,IAAP,CAAYC,KAAZ,GAAoBtD,CAAC,CAACY,OAAF,CAAUN,KAAK,CAACS,IAAhB,IAAwB,CAAxB,GAA4BT,KAAK,CAACS,IAAN,CAAWU,GAA3D;AACAvB,MAAAA,MAAM,CAACW,UAAP,GAAoB/C,OAApB;AAEAiE,MAAAA,OAAO,CAACC,GAAR,CAAY,2CAAZ;AACD;;AAED,QAAI9B,MAAM,CAACqD,SAAP,KAAqB,KAArB,IAA8BrD,MAAM,CAACsD,UAAP,KAAsB,KAAxD,EAA+D;AAC7D;AACAtD,MAAAA,MAAM,CAACpC,OAAP;AACAiE,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;AAEA9B,MAAAA,MAAM,CAACuD,GAAP,CAAW,SAAX,EAAsB/D,SAAtB;AACAQ,MAAAA,MAAM,CAACuD,GAAP,CAAW,UAAX,EAAuBC,UAAvB;AACAxD,MAAAA,MAAM,CAACuD,GAAP,CAAW,YAAX,EAAyB9D,YAAzB;AACAO,MAAAA,MAAM,CAACuD,GAAP,CAAW,eAAX,EAA4BE,YAA5B;AACAzD,MAAAA,MAAM,CAACuD,GAAP,CAAW,gBAAX,EAA6BE,YAA7B;AACAzD,MAAAA,MAAM,CAACuD,GAAP,CAAW,OAAX,EAAoBG,SAApB;AAEA1D,MAAAA,MAAM,CAACuD,GAAP,CAAW,QAAX,EAAqBI,MAArB;AACA3D,MAAAA,MAAM,CAACuD,GAAP,CAAW,WAAX,EAAwBK,SAAxB;AACA5D,MAAAA,MAAM,CAACuD,GAAP,CAAW,WAAX,EAAwBM,SAAxB;AACA7D,MAAAA,MAAM,CAACuD,GAAP,CAAW,aAAX,EAA0BO,WAA1B;AACA9D,MAAAA,MAAM,CAACuD,GAAP,CAAW,MAAX,EAAmBQ,IAAnB;AACA/D,MAAAA,MAAM,CAACuD,GAAP,CAAW,gBAAX,EAA6BS,cAA7B;AACD,KAlBD,MAkBK,CACH;AACD;;AAEDhE,IAAAA,MAAM,CAACiE,EAAP,CAAU,SAAV,EAAqBzE,SAArB;AACAQ,IAAAA,MAAM,CAACiE,EAAP,CAAU,UAAV,EAAsBT,UAAtB;AACAxD,IAAAA,MAAM,CAACiE,EAAP,CAAU,YAAV,EAAwBxE,YAAxB;AACAO,IAAAA,MAAM,CAACiE,EAAP,CAAU,eAAV,EAA2BR,YAA3B;AACAzD,IAAAA,MAAM,CAACiE,EAAP,CAAU,gBAAV,EAA4BR,YAA5B;AACAzD,IAAAA,MAAM,CAACiE,EAAP,CAAU,OAAV,EAAmBP,SAAnB;AAEA1D,IAAAA,MAAM,CAACiE,EAAP,CAAU,QAAV,EAAoBN,MAApB;AACA3D,IAAAA,MAAM,CAACiE,EAAP,CAAU,WAAV,EAAuBL,SAAvB;AACA5D,IAAAA,MAAM,CAACiE,EAAP,CAAU,WAAV,EAAuBJ,SAAvB;AACA7D,IAAAA,MAAM,CAACiE,EAAP,CAAU,aAAV,EAAyBH,WAAzB;AACA9D,IAAAA,MAAM,CAACiE,EAAP,CAAU,MAAV,EAAkBF,IAAlB;AACA/D,IAAAA,MAAM,CAACuD,GAAP,CAAW,gBAAX,EAA6BS,cAA7B;AACD,GAtED;;AAwEA,QAAMN,SAAS,GAAIQ,CAAD,IAAM;AACtBrC,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BoC,CAA3B;;AACA,YAAOA,CAAC,CAACC,IAAT;AACE,WAAK,MAAL;AAAY;AACV,cAAI;AAACC,YAAAA;AAAD,cAAmBF,CAAvB;;AAEA,kBAAOE,cAAP;AACE,iBAAK,QAAL;AAAc;AACZ1F,gBAAAA,EAAE,CAAC2F,MAAH,CAAU,YAAV;AACA3F,gBAAAA,EAAE,CAAC2F,MAAH,CAAU,SAAV;AAEArE,gBAAAA,MAAM,CAACW,UAAP;AACAP,gBAAAA,KAAK,CAAClB,UAAN;AAEAW,gBAAAA,OAAO,CAACyE,IAAR,CAAa,GAAb;AACA;AACD;AAVH;;AAYA;AACD;;AAED,WAAK,SAAL;AAAe;AAEb,cAAI;AAACF,YAAAA,cAAD;AAAiBG,YAAAA;AAAjB,cAA0BL,CAA9B;;AAEA,kBAAOE,cAAP;AACE,iBAAK,QAAL;AAAc;AAEZ;AACD;;AAED,iBAAK,SAAL;AACH,iBAAK,QAAL;AAAc;AACThE,gBAAAA,KAAK,CAACT,cAAN,CAAqB4E,KAArB;AACA;AACD;AAVH;;AAaA;AACD;;AAED,WAAK,SAAL;AAAe;AACb,cAAI;AAACH,YAAAA,cAAD;AAAiBG,YAAAA;AAAjB,cAA0BL,CAA9B;;AAEA,kBAAOE,cAAP;AACE,iBAAK,aAAL;AAAmB;AACjBhE,gBAAAA,KAAK,CAACR,cAAN,CAAqB,KAArB;AACA;AACD;AAJH;;AAMA;AACD;AAjDH;AAmDD,GArDD;;AAuDA,QAAMmE,IAAI,GAAInC,IAAD,IAAQ;AACnBC,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBF,IAAtB;AACD,GAFD;;AAIA,QAAM6B,YAAY,GAAIe,GAAD,IAAO;AAC1B3C,IAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EAA8C0C,GAA9C;AACD,GAFD;;AAIA,QAAMhF,SAAS,GAAG,MAAK;AACrBqC,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AAEA1B,IAAAA,KAAK,CAACZ,SAAN,CAAgB;AAAC6D,MAAAA,SAAS,EAAErD,MAAM,CAACqD;AAAnB,KAAhB,EAHqB,CAKrB;AACD,GAND;;AAQA,QAAM5D,YAAY,GAAG,MAAK;AACxBoC,IAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AAEA1B,IAAAA,KAAK,CAACX,YAAN,GAHwB,CAKxB;AACD,GAND;;AAQA,QAAM+D,UAAU,GAAI5B,IAAD,IAAS,CAC1B;AAEA;AAEA;AAEA;AACD,GARD;;AAUA,QAAM+B,MAAM,GAAI/B,IAAD,IAAS;AACtBC,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBF,IAAxB;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKI;AACD,GA9BD;;AAgCA,QAAMgC,SAAS,GAAIhC,IAAD,IAAS;AACzBxB,IAAAA,KAAK,CAACnB,SAAN,CAAgB2C,IAAhB;AACD,GAFD;;AAIA,QAAMiC,SAAS,GAAIjC,IAAD,IAAS;AACzBC,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BF,IAA3B,EADyB,CAGzB;;AAEA,QAAI;AACF,UAAI6C,IAAI,GAAG7C,IAAI,CAAC6C,IAAhB;AACA5C,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8B2C,IAA9B;;AACA,cAAOA,IAAP;AACE,aAAK,KAAL;AAAW;AACT5C,YAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA1B,YAAAA,KAAK,CAACjB,QAAN,CAAeyC,IAAf;AACA;AACD;;AACD,aAAK,MAAL;AAAY;AACVC,YAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACA1B,YAAAA,KAAK,CAAChB,WAAN,CAAkBwC,IAAlB;AACA;AACD;;AACD,aAAK,QAAL;AAAc;AACZC,YAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACA1B,YAAAA,KAAK,CAACf,WAAN,CAAkBuC,IAAlB;AACA;AACD;AAfH;AAiBD,KApBD,CAoBE,OAAO8C,KAAP,EAAc;AACd;AACA;AACA;AACA7C,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiC4C,KAAjC;AACD;AACF,GA/BD;;AAiCA,QAAMZ,WAAW,GAAIlC,IAAD,IAAS;AAC3B,QAAG;AACDC,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCF,IAAhC;AAEAxB,MAAAA,KAAK,CAACd,aAAN,CAAoBsC,IAApB;AACD,KAJD,CAIE,OAAO4C,GAAP,EAAY;AACZ3C,MAAAA,OAAO,CAACC,GAAR,CAAY0C,GAAZ;AACD;AACF,GARD;;AAUA,QAAMR,cAAc,GAAIpC,IAAD,IAAS;AAC9BC,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCF,IAAjC,EAD8B,CAG9B;AACD,GAJD;;AAMA,QAAM+C,aAAa,GAAG,MAAK;AACzB,wBAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAR;AACD,GAFD;;AAIA,QAAMC,UAAU,GAAG,MAAK;AACtB,wBAAQ;AAAA,8BACE,QAAC,SAAD;AAAA,gCACA,QAAC,cAAD;AAAA;AAAA;AAAA;AAAA,gBADA,eAEA,QAAC,WAAD;AAAA,oBACG7F,MAAM,CAAC8F,GAAP,CAAW,CAAC;AAAEC,YAAAA,IAAF;AAAQC,YAAAA,IAAR;AAAcC,YAAAA;AAAd,WAAD,EAA4BC,GAA5B,kBACV,QAAC,UAAD;AACE,YAAA,KAAK,MADP;AAEE,YAAA,IAAI,EAAEH,IAFR;AAIE,YAAA,MAAM,EAAE1E,KAAK,IAAI;AACf,oBAAM8E,MAAM,GAAGnG,MAAM,CACnB;AADmB,eAElBkC,MAFY,CAEL,CAAC;AAAE6D,gBAAAA;AAAF,eAAD,KAAc1E,KAAK,CAAC+E,KAAN,CAAYL,IAAZ,CAAiBM,QAAjB,CAA0BN,IAA1B,CAFT,EAGb;AACA;AAJa,eAKZD,GALY,CAKR,CAAC;AAAEC,gBAAAA,IAAF;AAAQ,mBAAGO;AAAX,eAAD,MAAwB;AAC3BP,gBAAAA,IAAI,EAAEQ,MAAM,CAACC,IAAP,CAAYnF,KAAK,CAAC+E,KAAN,CAAYK,MAAxB,EAAgCC,MAAhC,GACFH,MAAM,CAACC,IAAP,CAAYnF,KAAK,CAAC+E,KAAN,CAAYK,MAAxB,EAAgCE,MAAhC,CACA,CAACZ,IAAD,EAAOa,KAAP,KAAiBb,IAAI,CAACc,OAAL,CACd,IAAGD,KAAM,EADK,EACFvF,KAAK,CAAC+E,KAAN,CAAYK,MAAZ,CAAmBG,KAAnB,CADE,CADjB,EAGGb,IAHH,CADE,GAMFA,IAPuB;AAQ3B,mBAAGO;AARwB,eAAxB,CALQ,CAAf,CADe,CAiBf;AACA;AACA;AAEA;AACA;;AACAH,cAAAA,MAAM,CAACL,GAAP,CAAW,CAAC;AAAEE,gBAAAA,IAAF;AAAQD,gBAAAA;AAAR,eAAD,KAAmB,CAAE,CAAhC,CACA;AADA;AAGA,kCACE;AAAK,gBAAA,SAAS,EAAC,WAAf;AAAA,uCACA;AAAK,kBAAA,SAAS,EAAC,WAAf;AAAA,0CACE;AAAK,oBAAA,SAAS,EAAC,KAAf;AAAA,2CACE,QAAC,UAAD;AAAY,sBAAA,MAAM,EAAEI;AAApB;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,0BADF,eAKE,QAAC,SAAD,OAAe9E;AAAf;AAAA;AAAA;AAAA;AAAA,0BALF,eAOE,QAAC,cAAD;AAAA;AAAA;AAAA;AAAA,0BAPF;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,sBADF;AAaD;AA3CH,aAGO6E,GAHP;AAAA;AAAA;AAAA;AAAA,kBADD;AADH;AAAA;AAAA;AAAA;AAAA,gBAFA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eAqDE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,cArDF;AAAA;AAAA;AAAA;AAAA;AAAA,YAAR;AAuDD,GAxDD;;AA0DA,sBAAQ,QAAC,MAAD;AAAQ,IAAA,OAAO,EAAEpF,OAAjB;AAAA,2BACE,QAAC,cAAD;AACE,MAAA,MAAM,EAAES,gBADV;AAEE,MAAA,OAAO,MAFT;AAGE,MAAA,IAAI,EAAC,SAHP;AAAA,6BAIE;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,gCACI,QAAC,SAAD,OAAgBF;AAAhB;AAAA;AAAA;AAAA;AAAA,gBADJ,EAEMC,WAAW,GAAGsE,aAAH,GAAmBC,UAFpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAJF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UAAR;AAWD,CAjbD;;GAAMzE,G;;KAAAA,G;;AAmbN,MAAM0F,eAAe,GAAG,CAACC,KAAD,EAAQC,QAAR,KAAqB;AAC5C,SAAO;AACJlF,IAAAA,IAAI,EAAEiF,KAAK,CAACjF,IAAN,CAAWe,IADb;AAEJoE,IAAAA,OAAO,EAAEF,KAAK,CAACE,OAAN,CAAcpE,IAFnB;AAGJqE,IAAAA,UAAU,EAAEH,KAAK,CAACjF,IAAN,CAAWoF,UAHnB;AAKJC,IAAAA,UAAU,EAAEJ,KAAK,CAACI,UAAN,CAAiBtE,IALzB;AAOJb,IAAAA,OAAO,EAAE+E,KAAK,CAACK,GAAN,CAAUpF,OAPf;AASJN,IAAAA,kBAAkB,EAAEqF,KAAK,CAACjF,IAAN,CAAWJ,kBAT3B;AAWJJ,IAAAA,WAAW,EAAEyF,KAAK,CAACM,OAAN,CAAc/F;AAXvB,GAAP;AAaA,CAdD;;AAgBA,MAAMgG,kBAAkB,GAAG;AACzBpH,EAAAA,SADyB;AAEzBC,EAAAA,UAFyB;AAIzBC,EAAAA,QAJyB;AAKzBC,EAAAA,WALyB;AAMzBC,EAAAA,WANyB;AAOzBC,EAAAA,aAPyB;AAQzBC,EAAAA,sBARyB;AAUzBC,EAAAA,SAVyB;AAWzBC,EAAAA,YAXyB;AAazBE,EAAAA,cAbyB;AAczBC,EAAAA;AAdyB,CAA3B;AAiBA,eAAehC,OAAO,CAACiI,eAAD,EAAkBQ,kBAAlB,CAAP,CAA6ClG,GAA7C,CAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux'\nimport { BrowserRouter, Router, Route, Switch } from 'react-router-dom'; \nimport Container from 'react-bootstrap/Container'\nimport { ToastContainer, toast } from 'react-toastify';\nimport LoadingOverlay from 'react-loading-overlay';\nimport io from 'socket.io-client';\nimport { CacheSwitch, CacheRoute, } from \"react-router-cache-route\";\nimport axios from 'axios';\nimport { Base64 } from 'js-base64';\nimport ls from 'local-storage';\nimport { deviceDetect } from \"react-device-detect\";\nimport HeaderBar from \"./components/HeaderBar\";\nimport Breadcrumb from \"./components/Breadcrumb\"\nimport Footer from './components/Footer';\n\nimport routes from \"./routes\";\nimport ScrollToTopBtn from \"./components/ScrollToTopBtn\";\nimport { userLogin, userLogout } from './actions/user';\nimport { addMyApp, updateMyApp, deleteMyApp } from './actions/my_apps';\n\nimport { onMyFollowALL, onMyFollowUpdateStatus } from './actions/my_follows'\n\nimport { onConnect, onDisconnect } from './actions/socket'\n\nimport { addContentsData, addFollowsData } from './actions/app'\n\nimport { setMaintenance } from './actions/setting'\n\nimport history from './history';\n\nvar _ = require('lodash');\n\nlet socket = undefined;\nlet interval = undefined;\n\nconst App = (props) => {\n  const [maintenance, setMaintenance]   = useState();\n  const [isLoadingOverlay, setIsLoadingOverlay]   = useState();\n\n  useEffect(() => {\n    checkLocalStorage()\n\n    setMaintenance(false)\n    return () => {\n      setMaintenance() \n\n      socket = undefined;\n      interval = undefined;\n    };\n  }, []);\n\n  useEffect(() => {\n    setMaintenance(props.maintenance)\n  }, [props.maintenance]);\n\n  useEffect(() => {\n    setIsLoadingOverlay(props.is_loading_overlay)\n  }, [props.is_loading_overlay]);\n\n  useEffect(() => {\n    \n    // console.log('socketid() > [props.user] #0 > ', props.user , socket )  \n\n    if( !_.isEmpty(socket) ){\n      socket.disconnect()\n      socket = null;\n    }\n    socketid()\n  }, [props.user]);\n\n  useEffect(async() => {\n    if( _.isEmpty(interval) ){\n      clearInterval(interval)\n\n      interval = undefined\n    }\n\n    // console.log('useEffect [props.follows] #1: ')\n\n    let {user, follows} = props\n    // console.log(\"useEffect [props.follows] #2:\", user, _.isEmpty(user), props)\n    if(!_.isEmpty(user)){\n\n      if(_.isEmpty(follows)){\n        return;\n      }\n\n      let filter_follow_ups = follows.filter((im)=>im.local)\n      \n      // console.log(\"useEffect [props.follows] #3:\", filter_follow_ups)\n      if(!_.isEmpty(filter_follow_ups)){\n        interval = setInterval(async(props)=>{\n          let {user, follows} = props\n          let response =  await axios.post(`/api/v1/syc_local`, \n                                          { \n                                            uid: user.uid, follows: JSON.stringify(follows) \n                                          }, \n                                          { headers: {'Authorization': `Basic ${ls.get('basic_auth')}` } });\n\n          response = response.data\n          console.log(\"/api/v1/syc_local : \", response )\n\n          if(response.result){\n            // props.onMyFollowUpdateStatus({})\n          }\n\n          clearInterval(interval)\n        }, 2000, props)\n      }else {\n        // console.log(\"useEffect [props.follows] #5:\")\n      }\n    }else{\n      // console.log(\"useEffect [props.follows] #6:\")\n    }\n  }, [props.follows]);\n\n  const checkLocalStorage = ()=>{\n    // http://apassant.net/2012/01/16/timeout-for-html5-localstorage/\n    \n    var hours = 4; // Reset when storage is more than 24hours\n    var now = new Date().getTime();\n    var setupTime = localStorage.getItem('setupTime');\n    if (setupTime == null) {\n      localStorage.setItem('setupTime', now)\n    } else {\n      if(now-setupTime > hours*60*60*1000) {\n        // localStorage.clear()\n\n        localStorage.removeItem('geolocation')\n\n        localStorage.setItem('setupTime', now);\n      }\n    }\n    \n  }\n\n  const geolocation = async () => {\n    let data = JSON.parse(localStorage.getItem(\"geolocation\"))\n    if(_.isEmpty(data)){\n      const res = await axios.get( process.env.REACT_APP_GEOLOCATION )\n      if(res.status === 200){\n        data = res.data\n      }\n\n      localStorage.setItem('geolocation', JSON.stringify(data))\n    }\n    return data;\n  }\n\n  const socketid = async() =>{\n    // console.log('process.env :', process.env, ', props : ', props, ', geolocation : ', await geolocation())\n\n    if(_.isEmpty(socket)){\n      socket = io( \"/\", \n        // { headers:  {'Authorization': `Basic ${process.env.REACT_APP_AUTHORIZATION}`} },\n        \n        // {\n        //   auth: {\n        //     token: \"abcd\"\n        //   }\n        // },\n        { \n          // path: '/mysocket',\n          // 'sync disconnect on unload': false,\n          'sync disconnect on unload': true,\n          query: {\n            // \"platform\" : process.env.REACT_APP_PLATFORM, \n            // \"unique_id\": _uniqueId(props),\n            \"version\"  : process.env.REACT_APP_VERSIONS,\n            \"device_detect\" : JSON.stringify( deviceDetect() ),\n            \"geolocation\" : JSON.stringify( await geolocation() ),\n            auth_token: _.isEmpty(props.user) ? 0 : props.user.uid\n          },\n          // transports: [\"websocket\"]\n        },\n        // { transports: [\"websocket\"] }\n        );\n    }else{\n      socket.auth.token = _.isEmpty(props.user) ? 0 : props.user.uid;\n      socket.disconnect().connect()\n\n      console.log('------------- disconnect ------------- #3')\n    }                 \n    \n    if (socket.connected === false && socket.connecting === false) {\n      // use a connect() or reconnect() here if you want\n      socket.connect()\n      console.log('reconnected!');\n\n      socket.off('connect', onConnect)\n      socket.off(\"uniqueID\", onUniqueID);\n      socket.off('disconnect', onDisconnect);\n      socket.off('connect_error', handleErrors);\n      socket.off('connect_failed', handleErrors);\n      socket.off('onSyc', handleSyc);\n\n      socket.off('onUser', onUser);\n      socket.off('onProfile', onProfile);\n      socket.off('onContent', onContent);\n      socket.off('onMyFollows', onMyFollows);\n      socket.off('test', test);\n      socket.off('onAppFollowers', onAppFollowers)\n    }else{\n      // console.log('socket :', socket)\n    }\n\n    socket.on('connect', onConnect)\n    socket.on(\"uniqueID\", onUniqueID);\n    socket.on('disconnect', onDisconnect);\n    socket.on('connect_error', handleErrors);\n    socket.on('connect_failed', handleErrors);\n    socket.on('onSyc', handleSyc);\n\n    socket.on('onUser', onUser);\n    socket.on('onProfile', onProfile);\n    socket.on('onContent', onContent);\n    socket.on('onMyFollows', onMyFollows);\n    socket.on('test', test);\n    socket.off('onAppFollowers', onAppFollowers)\n  }\n\n  const handleSyc = (i) =>{\n    console.log(\"handleSyc :\", i )\n    switch(i.type){\n      case 'user':{\n        let {operation_type} = i\n\n        switch(operation_type){\n          case 'delete':{\n            ls.remove('basic_auth')\n            ls.remove('session')\n\n            socket.disconnect();  \n            props.userLogout()\n            \n            history.push(\"/\");\n            break;\n          }\n        }\n        break;\n      }\n\n      case 'follows':{\n\n        let {operation_type, datas} = i\n\n        switch(operation_type){\n          case 'insert':{\n\n            break;\n          }\n\n          case 'replace':\n\t\t\t    case 'update':{\n            props.addFollowsData(datas)\n            break;\n          }\n        }\n\n        break;\n      }\n\n      case 'setting':{\n        let {operation_type, datas} = i\n\n        switch(operation_type){\n          case 'maintenance':{\n            props.setMaintenance(false)\n            break;\n          }\n        }\n        break;\n      }\n    }\n  }\n\n  const test = (data)=>{\n    console.log(\"test :\", data)\n  }\n\n  const handleErrors = (err)=>{\n    console.log('connect_error + connect_failed', err);\n  }\n\n  const onConnect = () =>{\n    console.log('Socket io, connent!');\n\n    props.onConnect({connected: socket.connected})\n\n    // props.setMaintenance(false)\n  }\n\n  const onDisconnect = () =>{\n    console.log('Socket io, disconnect!');\n\n    props.onDisconnect()\n\n    // props.setMaintenance(true)\n  }\n\n  const onUniqueID = (data) =>{\n    // console.log(\"unique_id :\", data)\n\n    // ls.set('socketIO', JSON.stringify(data))\n\n    // var socketIO = ls.get('socketIO')\n\n    // console.log(\"socketIO :\", socketIO)\n  }\n\n  const onUser = (data) =>{\n    console.log(\"onUser :\", data)\n\n    /*\n    try {\n      let mode = data.mode\n      console.log(\"onUser mode\", mode)\n      switch(mode){\n        case 'delete':{\n          socket.disconnect();\n\n          console.log('------------- disconnect ------------- #4')\n\n          ls.remove('basic_auth')\n          ls.remove('session')\n          props.userLogout()\n\n          console.log(\"onUser ok\",)\n          break;\n        }\n      }\n    } catch (error) {\n      // Catch internal functions, variables and return (jsx) errors.\n      // You can also create a lib to log the error to an error reporting service\n      // and use it here.\n      console.log(\"onUser error :\", error)\n    }\n\n    */\n    // mode: \"delete\"\n  }\n\n  const onProfile = (data) =>{\n    props.userLogin(data) \n  }\n\n  const onContent = (data) =>{\n    console.log(\"onContent :\", data)\n\n    // mode: \"edit\", nid: \"104\"}\n\n    try {\n      let mode = data.mode\n      console.log(\"onContent mode\", mode)\n      switch(mode){\n        case 'add':{\n          console.log(\"onContent add\")\n          props.addMyApp(data)\n          break;\n        }\n        case 'edit':{\n          console.log(\"onContent edit\")\n          props.updateMyApp(data)\n          break;\n        }\n        case 'delete':{\n          console.log(\"onContent delete\")\n          props.deleteMyApp(data)\n          break;\n        }\n      }\n    } catch (error) {\n      // Catch internal functions, variables and return (jsx) errors.\n      // You can also create a lib to log the error to an error reporting service\n      // and use it here.\n      console.log(\"onContent error :\", error)\n    }\n  }\n\n  const onMyFollows = (data) =>{\n    try{\n      console.log(\"MY_FOLLOW_ALL : \", data)\n\n      props.onMyFollowALL(data)\n    } catch (err) {\n      console.log(err)\n    }\n  }\n\n  const onAppFollowers = (data) =>{\n    console.log(\"onAppFollowers : \", data)\n\n    // props.onMyFollowALL(data)\n  }\n\n  const onMaintenance = () =>{\n    return (<div>We’ll be back soon! Sorry for the inconvenience but we’re performing some maintenance at the moment. We’ll be back online shortly!</div>)\n  }\n\n  const onMainView = () =>{\n    return (<div>\n              <Container>\n              <ToastContainer />\n              <CacheSwitch>\n                {routes.map(({ path, name, Component }, key) => (\n                  <CacheRoute\n                    exact\n                    path={path}\n                    key={key}\n                    render={props => {\n                      const crumbs = routes\n                        // Get all routes that contain the current one.\n                        .filter(({ path }) => props.match.path.includes(path))\n                        // Swap out any dynamic routes with their param values.\n                        // E.g. \"/pizza/:pizzaId\" will become \"/pizza/1\"\n                        .map(({ path, ...rest }) => ({\n                          path: Object.keys(props.match.params).length\n                            ? Object.keys(props.match.params).reduce(\n                              (path, param) => path.replace(\n                                `:${param}`, props.match.params[param]\n                              ), path\n                              )\n                            : path,\n                          ...rest\n                        }));\n\n                      // if(this.props.logged_in){\n                      //   connect_socketIO(this.props)\n                      // }\n\n                      // console.log();\n                      // console.log(`Generated crumbs for ${props.match.path}`);\n                      crumbs.map(({ name, path }) =>{}\n                      //  console.log({ name, path })\n                      );\n                      return (\n                        <div className=\"bg-gray25\">\n                        <div className=\"container\">\n                          <div className=\"row\">\n                            <Breadcrumb crumbs={crumbs} />\n                          </div>\n                          \n                          <Component {...props} />\n\n                          <ScrollToTopBtn />\n                        </div>\n                        </div>\n                      );\n                    }}\n                  />\n                ))}\n              </CacheSwitch>\n              </Container>\n              <Footer />  \n            </div>)\n  }\n\n  return( <Router history={history}>\n            <LoadingOverlay\n              active={isLoadingOverlay}\n              spinner\n              text='Wait...'>\n              <div className=\"App\">\n                  <HeaderBar  {...props}/>\n                  { maintenance ? onMaintenance : onMainView }\n              </div>\n            </LoadingOverlay>\n          </Router>)\n}\n\nconst mapStateToProps = (state, ownProps) => {\n\treturn {\n    user: state.user.data,\n    my_apps: state.my_apps.data,\n    follow_ups: state.user.follow_ups,\n\n    my_follows: state.my_follows.data,\n\n    follows: state.app.follows,\n\n    is_loading_overlay: state.user.is_loading_overlay,\n\n    maintenance: state.setting.maintenance\n  };\n}\n\nconst mapDispatchToProps = {\n  userLogin,\n  userLogout,\n\n  addMyApp, \n  updateMyApp, \n  deleteMyApp,\n  onMyFollowALL,\n  onMyFollowUpdateStatus,\n\n  onConnect, \n  onDisconnect ,\n\n  addFollowsData,\n  setMaintenance\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App)"]},"metadata":{},"sourceType":"module"}