{"ast":null,"code":"import { ADD_CONTENTS_DATA, ADD_FOLLOWS_DATA, ADD_FOLLOW_DATA, SET_TOTAL_VALUE, CLEAR_ALL_CONTENTS_DATA, MY_FOLLOW } from '../constants';\n\nvar _ = require('lodash');\n\nconst initialState = {\n  total_value: 0,\n  data: [],\n  follows: []\n};\n\nconst app = (state = initialState, action) => {\n  switch (action.type) {\n    case ADD_CONTENTS_DATA:\n      {\n        let merged = _.merge(_.keyBy(state.data, 'nid'), _.keyBy(action.data, 'nid'));\n\n        return { ...state,\n          data: _.values(merged)\n        };\n      }\n\n    case SET_TOTAL_VALUE:\n      {\n        return { ...state,\n          total_value: action.data\n        };\n      }\n\n    case ADD_FOLLOWS_DATA:\n      {\n        let merged = _.merge(_.keyBy(state.follows, 'nid'), _.keyBy(action.data, 'nid'));\n\n        return { ...state,\n          follows: _.values(merged)\n        };\n      }\n\n    case ADD_FOLLOW_DATA:\n      {\n        let state_data = state.data;\n        let state_follows = state.follows;\n        let action_data = action.data; // ------------- content -------------\n        // console.log('MY_FOLLOW > #0 ', state_data, action_data.nid)\n\n        let find_content = state_data.find(o => o.nid == action_data.nid);\n\n        if (!_.isEmpty(find_content)) {\n          let index = state_data.findIndex(o => o.nid == action_data.nid);\n\n          if (_.has(find_content, 'app_followers')) {\n            // console.log('MY_FOLLOW > #1 ', action_data, find_content)\n            let app_followers = find_content.app_followers;\n            let find_app_followers = app_followers.find(o => o.uid === action_data.uid);\n\n            if (_.isEmpty(find_app_followers)) {\n              app_followers = [...app_followers, {\n                uid: action_data.uid,\n                status: action_data.status,\n                date: Date.now()\n              }];\n            } else {\n              app_followers = app_followers.map(o => {\n                if (o.uid === action_data.uid) {\n                  o.status = action_data.status;\n                }\n\n                return o;\n              });\n            }\n\n            find_content = { ...find_content,\n              app_followers\n            };\n          } else {\n            find_content = { ...find_content,\n              app_followers: [{\n                uid: action_data.uid,\n                status: action_data.status,\n                date: Date.now()\n              }]\n            };\n          }\n\n          state_data.splice(index, 1, find_content); // ------------- content -------------\n          // ------------- follows -------------\n          // console.log('MY_FOLLOW > #2 ',action_data, state_follows)\n\n          let find_follow = state_follows.find(o => o.nid === action_data.nid);\n          let follows = [];\n\n          if (!_.isEmpty(find_follow)) {\n            // console.log('MY_FOLLOW > #3 ')\n            follows = state_follows.map(o => {\n              if (o.nid === action_data.nid) {\n                o.status = action_data.status;\n                o.local = true;\n              }\n\n              return o;\n            });\n          } else {\n            // console.log('MY_FOLLOW > #4 ')\n            follows = [...state_follows, {\n              \"nid\": action_data.nid,\n              \"status\": action_data.status,\n              \"date\": Date.now(),\n              \"local\": true\n            }];\n          } // console.log('MY_FOLLOW > #5 ', follows)\n          // ------------- follows -------------\n\n\n          return { ...state,\n            data: state_data,\n            follows\n          };\n        }\n        /*\n        let index = state_data.findIndex((obj => obj.nid == action_data.nid));\n        \n        let __t = state_data[index];\n        if(!_.isEmpty(__t)){\n          let app_followers = __t.app_followers\n             let _index = app_followers.findIndex((obj => obj.uid == action_data.uid));\n          if(_index === -1){\n            app_followers = [...app_followers, {uid: action_data.uid, status: true, date  : Date.now()}]\n          }else{\n            app_followers[_index].status = action_data.status\n            console.log('app_followers :', app_followers, app_followers[_index].status)\n          }\n           state_data.splice(index,1, {...__t, app_followers})\n        }\n         return { ...state, data: state_data};\n        */\n        // return state\n\n      }\n\n    case CLEAR_ALL_CONTENTS_DATA:\n      {\n        return initialState;\n      }\n\n    default:\n      return state;\n  }\n};\n\nexport default app;","map":{"version":3,"sources":["/app/src/reducers/app.js"],"names":["ADD_CONTENTS_DATA","ADD_FOLLOWS_DATA","ADD_FOLLOW_DATA","SET_TOTAL_VALUE","CLEAR_ALL_CONTENTS_DATA","MY_FOLLOW","_","require","initialState","total_value","data","follows","app","state","action","type","merged","merge","keyBy","values","state_data","state_follows","action_data","find_content","find","o","nid","isEmpty","index","findIndex","has","app_followers","find_app_followers","uid","status","date","Date","now","map","splice","find_follow","local"],"mappings":"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","sourcesContent":["import { ADD_CONTENTS_DATA, ADD_FOLLOWS_DATA, ADD_FOLLOW_DATA, SET_TOTAL_VALUE, CLEAR_ALL_CONTENTS_DATA, MY_FOLLOW } from '../constants';\n\nvar _ = require('lodash');\n\nconst initialState = {\n  total_value: 0,\n  data: [],\n  follows: []\n}\n\nconst app = (state = initialState, action) => {\n  switch (action.type) {\n    case ADD_CONTENTS_DATA:{\n      let merged = _.merge(_.keyBy(state.data, 'nid'), _.keyBy(action.data, 'nid'));\n      return { ...state, data: _.values(merged)}\n    }\n\n    case SET_TOTAL_VALUE:{\n      return { ...state, total_value: action.data}\n    }\n\n    case ADD_FOLLOWS_DATA: {\n      let merged = _.merge(_.keyBy(state.follows, 'nid'), _.keyBy(action.data, 'nid'));\n      return { ...state, follows: _.values(merged)}\n    }\n\n    case ADD_FOLLOW_DATA:{\n      let state_data    = state.data\n      let state_follows = state.follows\n\n      let action_data   = action.data;\n\n      // ------------- content -------------\n      // console.log('MY_FOLLOW > #0 ', state_data, action_data.nid)\n      let find_content = state_data.find((o) => o.nid == action_data.nid)\n      if(!_.isEmpty(find_content)){\n\n        let index = state_data.findIndex((o) => o.nid == action_data.nid)\n\n        if(_.has(find_content, 'app_followers')){\n          // console.log('MY_FOLLOW > #1 ', action_data, find_content)\n\n          let app_followers = find_content.app_followers\n          let find_app_followers = app_followers.find((o)=>o.uid === action_data.uid)\n          if(_.isEmpty(find_app_followers)){\n            app_followers = [...app_followers, {uid: action_data.uid, status: action_data.status, date  : Date.now()}]\n          }else{\n            app_followers = app_followers.map((o)=>{\n                                  if(o.uid === action_data.uid){\n                                    o.status = action_data.status\n                                  }\n                                  return o\n                                })\n          }\n\n          find_content = {...find_content, app_followers}\n        }else{\n          find_content = {...find_content, app_followers: [{uid: action_data.uid, status: action_data.status, date  : Date.now()}]}\n        }\n\n        state_data.splice(index, 1, find_content)\n\n        // ------------- content -------------\n\n        // ------------- follows -------------\n\n\n        // console.log('MY_FOLLOW > #2 ',action_data, state_follows)\n\n        let find_follow = state_follows.find((o)=>o.nid === action_data.nid)\n\n        let follows = []\n        if(!_.isEmpty(find_follow)){\n          // console.log('MY_FOLLOW > #3 ')\n          follows = state_follows.map((o)=>{\n                          if(o.nid === action_data.nid){\n                            o.status = action_data.status;\n                            o.local  = true;\n                          }\n                          return o\n                        })\n        }else {\n          // console.log('MY_FOLLOW > #4 ')\n          follows = [...state_follows, { \"nid\": action_data.nid, \"status\": action_data.status, \"date\": Date.now(), \"local\": true}]\n        }\n       \n        // console.log('MY_FOLLOW > #5 ', follows)\n        // ------------- follows -------------\n        \n        return { ...state, data: state_data, follows};\n      }\n\n      \n      /*\n      let index = state_data.findIndex((obj => obj.nid == action_data.nid));\n      \n      let __t = state_data[index];\n      if(!_.isEmpty(__t)){\n        let app_followers = __t.app_followers\n\n\n\n        let _index = app_followers.findIndex((obj => obj.uid == action_data.uid));\n        if(_index === -1){\n          app_followers = [...app_followers, {uid: action_data.uid, status: true, date  : Date.now()}]\n        }else{\n          app_followers[_index].status = action_data.status\n          console.log('app_followers :', app_followers, app_followers[_index].status)\n        }\n\n        state_data.splice(index,1, {...__t, app_followers})\n      }\n\n      return { ...state, data: state_data};\n      */\n\n      // return state\n    }\n\n    case CLEAR_ALL_CONTENTS_DATA:{\n      return initialState\n    }\n      \n    default:\n      return state;\n  }\n}\n\nexport default app"]},"metadata":{},"sourceType":"module"}