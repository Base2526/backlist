{"ast":null,"code":"import { ADD_CONTENTS_DATA, ADD_FOLLOWS_DATA, SET_TOTAL_VALUE, CLEAR_ALL_CONTENTS_DATA, MY_FOLLOW } from '../constants';\n\nvar _ = require('lodash');\n\nconst initialState = {\n  total_value: 0,\n  data: [],\n  follows: []\n};\n\nconst app = (state = initialState, action) => {\n  switch (action.type) {\n    case ADD_CONTENTS_DATA:\n      {\n        let merged = _.merge(_.keyBy(state.data, 'nid'), _.keyBy(action.data, 'nid'));\n\n        return { ...state,\n          data: _.values(merged)\n        };\n      }\n\n    case SET_TOTAL_VALUE:\n      {\n        return { ...state,\n          total_value: action.data\n        };\n      }\n\n    case MY_FOLLOW:\n      {\n        let state_data = state.data;\n        let state_follows = state.follows;\n        let action_data = action.data; // ------------- content -------------\n\n        console.log('MY_FOLLOW > #0 ', state_data, action_data.nid);\n        let find_content = state_data.find(o => o.nid == action_data.nid);\n\n        if (!_.isEmpty(find_content)) {\n          let index = state_data.findIndex(o => o.nid == action_data.nid);\n\n          if (_.has(find_content, 'app_followers')) {\n            console.log('MY_FOLLOW > #1 ', action_data, find_content);\n            let app_followers = find_content.app_followers;\n            let find_app_followers = app_followers.find(o => o.uid === action_data.uid);\n\n            if (_.isEmpty(find_app_followers)) {\n              app_followers = [...app_followers, {\n                uid: action_data.uid,\n                status: action_data.status,\n                date: Date.now()\n              }];\n            } else {\n              app_followers = app_followers.map(o => {\n                if (o.uid === action_data.uid) {\n                  o.status = action_data.status;\n                }\n\n                return o;\n              });\n            }\n\n            find_content = { ...find_content,\n              app_followers\n            };\n          } else {\n            find_content = { ...find_content,\n              app_followers: [{\n                uid: action_data.uid,\n                status: action_data.status,\n                date: Date.now()\n              }]\n            };\n          }\n\n          state_data.splice(index, 1, find_content); // ------------- content -------------\n          // ------------- follows -------------\n\n          console.log('MY_FOLLOW > #2 ', action_data, state_follows);\n          let find_follow = state_follows.find(o => o.nid === action_data.nid);\n\n          if (!_.isEmpty(find_follow)) {\n            let follows = state_follows.map(o => {\n              if (o.nid === action_data.nid) {\n                o.status = action_data.status;\n              }\n\n              return o;\n            });\n          }\n          /*\n           [\n          {\n          \"nid\": 193,\n          \"status\": true,\n          \"date\": 1630767606906,\n          \"local\": false\n          },\n          ]\n           {uid: 60, nid: 304, status: true}\n           {\n              nid: 194,\n              status: true,\n              date: 1630642184460,\n              local: false\n          },\n          */\n          // ------------- follows -------------\n\n\n          return { ...state,\n            data: state_data\n          };\n        }\n        /*\n        let index = state_data.findIndex((obj => obj.nid == action_data.nid));\n        \n        let __t = state_data[index];\n        if(!_.isEmpty(__t)){\n          let app_followers = __t.app_followers\n             let _index = app_followers.findIndex((obj => obj.uid == action_data.uid));\n          if(_index === -1){\n            app_followers = [...app_followers, {uid: action_data.uid, status: true, date  : Date.now()}]\n          }else{\n            app_followers[_index].status = action_data.status\n            console.log('app_followers :', app_followers, app_followers[_index].status)\n          }\n           state_data.splice(index,1, {...__t, app_followers})\n        }\n         return { ...state, data: state_data};\n        */\n        // return state\n\n      }\n\n    case ADD_FOLLOWS_DATA:\n      {\n        let merged = _.merge(_.keyBy(state.follows, 'nid'), _.keyBy(action.data, 'nid'));\n\n        return { ...state,\n          follows: _.values(merged)\n        };\n      }\n\n    case CLEAR_ALL_CONTENTS_DATA:\n      {\n        return initialState;\n      }\n\n    default:\n      return state;\n  }\n};\n\nexport default app;","map":{"version":3,"sources":["/app/src/reducers/app.js"],"names":["ADD_CONTENTS_DATA","ADD_FOLLOWS_DATA","SET_TOTAL_VALUE","CLEAR_ALL_CONTENTS_DATA","MY_FOLLOW","_","require","initialState","total_value","data","follows","app","state","action","type","merged","merge","keyBy","values","state_data","state_follows","action_data","console","log","nid","find_content","find","o","isEmpty","index","findIndex","has","app_followers","find_app_followers","uid","status","date","Date","now","map","splice","find_follow"],"mappings":"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","sourcesContent":["import { ADD_CONTENTS_DATA, ADD_FOLLOWS_DATA, SET_TOTAL_VALUE, CLEAR_ALL_CONTENTS_DATA, MY_FOLLOW } from '../constants';\n\nvar _ = require('lodash');\n\nconst initialState = {\n  total_value: 0,\n  data: [],\n  follows: []\n}\n\nconst app = (state = initialState, action) => {\n  switch (action.type) {\n    case ADD_CONTENTS_DATA:{\n      let merged = _.merge(_.keyBy(state.data, 'nid'), _.keyBy(action.data, 'nid'));\n      return { ...state, data: _.values(merged)}\n    }\n\n    case SET_TOTAL_VALUE:{\n      return { ...state, total_value: action.data}\n    }\n\n    case MY_FOLLOW:{\n      let state_data    = state.data\n      let state_follows = state.follows\n\n      let action_data   = action.data;\n\n      // ------------- content -------------\n      console.log('MY_FOLLOW > #0 ', state_data, action_data.nid)\n      let find_content = state_data.find((o) => o.nid == action_data.nid)\n      if(!_.isEmpty(find_content)){\n\n        let index = state_data.findIndex((o) => o.nid == action_data.nid)\n\n        if(_.has(find_content, 'app_followers')){\n          console.log('MY_FOLLOW > #1 ', action_data, find_content)\n\n          let app_followers = find_content.app_followers\n          let find_app_followers = app_followers.find((o)=>o.uid === action_data.uid)\n          if(_.isEmpty(find_app_followers)){\n            app_followers = [...app_followers, {uid: action_data.uid, status: action_data.status, date  : Date.now()}]\n          }else{\n            app_followers = app_followers.map((o)=>{\n                                  if(o.uid === action_data.uid){\n                                    o.status = action_data.status\n                                  }\n                                  return o\n                                })\n          }\n\n          find_content = {...find_content, app_followers}\n        }else{\n          find_content = {...find_content, app_followers: [{uid: action_data.uid, status: action_data.status, date  : Date.now()}]}\n        }\n\n        state_data.splice(index, 1, find_content)\n\n        // ------------- content -------------\n\n        // ------------- follows -------------\n\n\n        console.log('MY_FOLLOW > #2 ',action_data, state_follows)\n\n        let find_follow = state_follows.find((o)=>o.nid === action_data.nid)\n\n        if(!_.isEmpty(find_follow)){\n          let follows = state_follows.map((o)=>{\n                          if(o.nid === action_data.nid){\n                            o.status = action_data.status\n                          }\n                          return o\n                        })\n        }\n        /*\n\n        [\n    {\n        \"nid\": 193,\n        \"status\": true,\n        \"date\": 1630767606906,\n        \"local\": false\n    },\n   \n\n]\n\n        {uid: 60, nid: 304, status: true}\n\n        {\n            nid: 194,\n            status: true,\n            date: 1630642184460,\n            local: false\n        },\n        */\n\n        // ------------- follows -------------\n        \n        return { ...state, data: state_data };\n      }\n\n      \n      /*\n      let index = state_data.findIndex((obj => obj.nid == action_data.nid));\n      \n      let __t = state_data[index];\n      if(!_.isEmpty(__t)){\n        let app_followers = __t.app_followers\n\n\n\n        let _index = app_followers.findIndex((obj => obj.uid == action_data.uid));\n        if(_index === -1){\n          app_followers = [...app_followers, {uid: action_data.uid, status: true, date  : Date.now()}]\n        }else{\n          app_followers[_index].status = action_data.status\n          console.log('app_followers :', app_followers, app_followers[_index].status)\n        }\n\n        state_data.splice(index,1, {...__t, app_followers})\n      }\n\n      return { ...state, data: state_data};\n      */\n\n      // return state\n    }\n\n    case ADD_FOLLOWS_DATA: {\n      let merged = _.merge(_.keyBy(state.follows, 'nid'), _.keyBy(action.data, 'nid'));\n      return { ...state, follows: _.values(merged)}\n    }\n\n    case CLEAR_ALL_CONTENTS_DATA:{\n      return initialState\n    }\n      \n    default:\n      return state;\n  }\n}\n\nexport default app"]},"metadata":{},"sourceType":"module"}